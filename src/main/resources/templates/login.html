<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
  <title>商城-登陆</title>
</head>
<body>
<!--  登录页面-->
<div class="container d-flex justify-content-center align-items-center vh-100">
  <!-- 居中 -->
  <div class="form row col-8 col-md-6 col-lg-4">
    <div class="form-horizontal" id="login_form">
      <h3 class="form-title text-center">系统登录</h3>
      <form class="row needs-validation" novalidate>
        <div class="form-group">
          <label for="username" class="form-label"></label>
          <input type="text" class="form-control" id="username" name="username" placeholder="账号/手机/邮箱" required>
          <div class="invalid-feedback">
            请输入用户名
          </div>
        </div>
        <div class="form-group">
          <label for="password" class="form-label"></label>
          <input type="password" class="form-control" id="password" name="password" placeholder="请输入密码" required>
          <div class="invalid-feedback">
            请输入密码
          </div>
        </div>
        <div class="col-12 mt-3">
          <button class="btn btn-primary col-12" type="submit">登录</button>
        </div>
        <div class="col-12 mt-3">
          <a href="/register" class="btn btn-link col-12">没有账号?点击注册</a>
        </div>
      </form>
    </div>
  </div>
</div>
</body>
<script type="text/javascript" th:src="@{/js/bootstrap.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.min.js}"></script>
<script>
  // Fetch all the forms we want to apply custom Bootstrap validation styles to
  const forms = document.querySelectorAll('.needs-validation')

  // Loop over them and prevent submission
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault()
        event.stopPropagation()
      }
      form.classList.add('was-validated')
    }, false)
  })

  // from submit
  $('#login_form').submit(function (e) {
    e.preventDefault()
    $.ajax({
      url: '/api/user/login',
      type: 'post',
      data: JSON.stringify({
        username: $('#username').val(),
        password: $('#password').val()
      }),
      contentType: 'application/json',
      success: function (data) {
        if (data.code !== "200") {
          alert(data.msg)
          return
        }
        // set local storage
        localStorage.setItem('user', JSON.stringify(data.data))
        // redirect
        window.location.href = '/'
      },
      error: function () {
        alert('登录失败, 请重新尝试')
      }
    })
  })
</script>
</html>