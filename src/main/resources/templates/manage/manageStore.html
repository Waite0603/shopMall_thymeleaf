<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>商城-店铺管理</title>
  <th:block th:replace="~{modules/common.html :: common_header}"></th:block></head>
<body class="d-flex flex-column justify-content-between min-vh-100">

<th:block th:replace="~{modules/header.html}"></th:block>

<main class="flex-grow-1 mt-3">
  <div class="container-fluid row">
    <th:block th:replace="~{modules/manageSibebar.html}"></th:block>

    <div class="content col-md-9">
      <h3 class="form-title text-center">商品管理</h3>

      <div class="type-control d-flex justify-content-between bg-light px-4 py-2 rounded">
        <div class="type-add">
          <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#modalBox">新增</button>
        </div>
        <div class="type-search d-flex">
          <label>
            <input class="form-control me-2" type="text" placeholder="搜索">
          </label>
          <button class="btn btn-success col-3" type="submit">搜索</button>
        </div>
      </div>

      <!-- 模态框 -->
      <div class="modal" id="modalBox">
        <div class="modal-dialog">
          <div class="modal-content">

            <!-- 模态框头部 -->
            <div class="modal-header">
              <h4 class="modal-title">请选择地址</h4>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- 模态框内容 -->
            <div class="modal-body">
              <form class="row needs-validation" novalidate>
                <div class="form-group row mt-2 d-flex align-items-center">
                  <label for="code" class="form-label col-sm-2">商品号</label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="code" required>
                    <div class="invalid-feedback">
                      请输入商品号
                    </div>
                  </div>
                </div>
                <div class="form-group row mt-2 d-flex align-items-center">
                  <label for="keywords" class="form-label col-sm-2">名字</label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="keywords" required>
                    <div class="invalid-feedback">
                      请输入名字
                    </div>
                  </div>
                </div>
                <div class="form-group row mt-2 d-flex align-items-center">
                  <label for="inPrice" class="form-label col-sm-2">进货价</label>
                  <div class="col-sm-10">
                    <input type="number" class="form-control" id="inPrice" required>
                    <div class="invalid-feedback">
                      请输入进货价
                    </div>
                  </div>
                </div>
                <div class="form-group row mt-2 d-flex align-items-center">
                  <label for="outPrice" class="form-label col-sm-2">优惠价</label>
                  <div class="col-sm-10">
                    <input type="number" class="form-control" id="outPrice" required>
                    <div class="invalid-feedback">
                      请输入优惠价
                    </div>
                  </div>
                </div>
                <div class="form-group row mt-2 d-flex align-items-center">
                  <label for="chSpec" class="form-label col-sm-2">标签</label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="chSpec" required>
                    <div class="invalid-feedback">
                      请输入标签
                    </div>
                  </div>
                </div>
                <div class="form-group row mt-2 d-flex align-items-center">
                  <label for="stock" class="form-label col-sm-2">库存</label>
                  <div class="col-sm-10">
                    <input type="number" class="form-control" id="stock" required>
                    <div class="invalid-feedback">
                      请输入库存
                    </div>
                  </div>
                </div>

                <!-- 选择框
                  <div class="form-group row mt-2 d-flex align-items-center">
                    <label class="form-label col-sm-2">状态</label>
                    <div class="col-sm-10">
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="status" id="status1"
                               value="0">
                        <label class="form-check-label" for="status1">冻结</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="status" id="status2"
                               value="1">
                        <label class="form-check-label" for="status2">正常</label>
                      </div>
                    </div>
                  </div>
                  <div class="form-group row mt-2 d-flex align-items-center">
                    <label class="form-label col-sm-2">类型</label>
                    <div class="col-sm-10">
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="option1">
                        <label class="form-check-label" for="inlineCheckbox1">1</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox2" value="option2">
                        <label class="form-check-label" for="inlineCheckbox2">2</label>
                      </div>
                    </div>
                  </div>
                -->
                <!-- 上传文件
                  <div class="form-group row mt-2 d-flex align-items-center">
                    <label class="form-label col-sm-2">Logo</label>
                    <div class="col-sm-10">
                      <input class="form-control" type="file" id="formFile">
                    </div>
                  </div>
                -->

              </form>
            </div>

            <!-- 模态框底部 -->
            <div class="modal-footer">
              <button type="button" onclick="handSubmit()" class="btn btn-primary">保存</button>
              <button type="button" class="btn btn-danger" data-bs-dismiss="modal">关闭</button>
            </div>
          </div>
        </div>
      </div>

      <table class="table table-hover mt-3">
        <thead>
        <tr>
          <th scope="col">编号</th>
          <th scope="col">商品号</th>
          <th scope="col">名字</th>
          <th scope="col">照片</th>
          <th scope="col">进货价</th>
          <th scope="col">优惠价</th>
          <th scope="col">标签</th>
          <th scope="col">库存</th>
          <th scope="col">操作</th>
        </tr>
        </thead>

        <tbody id="store-view"></tbody>
      </table>

      <!--
      <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
          <li class="page-item">
            <a class="page-link" href="#" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>
          <li class="page-item"><a class="page-link" href="#">1</a></li>
          <li class="page-item"><a class="page-link" href="#">2</a></li>
          <li class="page-item"><a class="page-link" href="#">3</a></li>
          <li class="page-item">
            <a class="page-link" href="#" aria-label="Next">
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
        </ul>
      </nav>
      -->
    </div>
  </div>
</main>

<th:block th:replace="~{modules/footer.html}"></th:block>
</body>
<th:block th:replace="~{modules/common.html :: common_js}"></th:block>
<script>
  const handSubmit = () => {
    $(".needs-validation").addClass("was-validated")

    // 数据获取
    let data = {
      "id": "90000",
      "keywords": $("#keywords").val(),
      "code": $("#code").val(),
      "spec": "",
      "chSpec": $("#chSpec").val(),
      "inPrice": $("#inPrice").val(),
      "outPrice": $("#outPrice").val(),
      "stock": $("#stock").val(),
      "imgUrl": "",
      "productId": 50001
    }

    // 数据提交
    $.ajax({
      url: "/api/goods/addGoods",
      type: "POST",
      headers: {
        "Authorization": localStorage.getItem("token")
      },
      contentType: "application/json",
      data: JSON.stringify(data),
      success: function (data) {
        console.log(data)
        if (data.code === "200") {
          swal("添加成功", "添加成功", "success")
          // 刷新页面
          setTimeout(function () {
            window.location.reload()
          }, 1000)
        } else {
          alert("添加失败")
        }
      }
    })


  }

  // 模态框关闭时清空表单
  $("#modalBox").on("hidden.bs.modal", function () {
    $(".needs-validation").removeClass("was-validated").find("input").val("")
  })

  // 获取商品
  $(document).ready(function () {
    $.ajax({
      url: "/api/goods/getAllGoods",
      type: "GET",
      headers: {
        "Authorization": localStorage.getItem("token")
      },
      success: function (data) {
        data = data.data.list

        let html = ""
        for (let i = 0; i < data.length; i++) {
          html += "<tr>"
          html += "<td>" + (i + 1) + "</td>"
          html += "<td>" + data[i]['code'] + "</td>"
          html += "<td>" + data[i]['keywords'] + "</td>"
          html += "<td><img src='https://qiniu.waite.wang/202401222127418.png' alt='' class='store-img'></td>"
          html += "<td>$" + data[i]['inPrice'].toFixed(2) + "</td>"
          html += "<td>$" + data[i]['outPrice'].toFixed(2) + "</td>"
          html += "<td>" + data[i]['chSpec'] + "</td>"
          html += "<td>" + data[i]['stock'] + "</td>"
          html += "<td><a href='#'>编辑</a></td>"
          html += "<td>"
        }
        $("#store-view").html(html)
      }
    })
  })


</script>

<style>
  .store-img {
    width: 30px;
    height: 30px;
    border-radius: 5px;
  }
</style>
</html>